# STON.fi Pools Dashboard

–î—ç—à–±–æ—Ä–¥ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—É–ª–æ–≤ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ –Ω–∞ DEX STON.fi –≤ –±–ª–æ–∫—á–µ–π–Ω–µ TON.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—É–ª–æ–≤ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- üìà –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π TVL, –æ–±—ä–µ–º–æ–≤ –∏ APY
- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- üíæ –•—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –≤ MySQL
- üê≥ –ü–æ–ª–Ω–∞—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Docker

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Backend**: PHP 8.2 + Yii2 Framework
- **Database**: MySQL 8.0
- **Web Server**: Nginx + PHP-FPM
- **Scheduler**: Cron
- **API**: STON.fi JSON-RPC API

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <repo-url>
cd Stonfi-pools

# –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –¥–∞–Ω–Ω—ã—Ö MySQL (–µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
mkdir -p docker/mysql/data

# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å .env —Ñ–∞–π–ª
cp .env.example .env

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose up -d
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# –í–æ–π—Ç–∏ –≤ PHP –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker-compose exec php bash

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å composer –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
composer install

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
php yii migrate --interactive=0

# –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
php yii pools/sync
```

### 3. –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ

```
http://localhost:8080
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
‚îú‚îÄ‚îÄ commands/           # Console –∫–æ–º–∞–Ω–¥—ã
‚îÇ   ‚îî‚îÄ‚îÄ PoolsController.php
‚îú‚îÄ‚îÄ config/            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ web.php
‚îÇ   ‚îú‚îÄ‚îÄ console.php
‚îÇ   ‚îú‚îÄ‚îÄ db.php
‚îÇ   ‚îî‚îÄ‚îÄ params.php
‚îú‚îÄ‚îÄ controllers/       # Web –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
‚îÇ   ‚îî‚îÄ‚îÄ PoolController.php
‚îú‚îÄ‚îÄ docker/           # Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ nginx/
‚îÇ   ‚îú‚îÄ‚îÄ php/
‚îÇ   ‚îî‚îÄ‚îÄ cron/
‚îú‚îÄ‚îÄ migrations/       # –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
‚îú‚îÄ‚îÄ models/          # AR –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ Pool.php
‚îÇ   ‚îî‚îÄ‚îÄ PoolSnapshot.php
‚îú‚îÄ‚îÄ services/        # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ StonfiApiService.php
‚îú‚îÄ‚îÄ views/          # –®–∞–±–ª–æ–Ω—ã
‚îÇ   ‚îú‚îÄ‚îÄ layouts/
‚îÇ   ‚îî‚îÄ‚îÄ pool/
‚îî‚îÄ‚îÄ web/           # –ü—É–±–ª–∏—á–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è
```

## API Endpoints

### Web –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- `GET /` - –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (—Å–ø–∏—Å–æ–∫ –ø—É–ª–æ–≤)
- `GET /pool/{address}` - –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—É–ª–µ
- `GET /pool/{address}/history?period=24h` - –ò—Å—Ç–æ—Ä–∏—è –ø—É–ª–∞ (JSON)

### Console –∫–æ–º–∞–Ω–¥—ã
```bash
# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Å API
php yii pools/sync

# –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Å–Ω–∏–º–∫–æ–≤ (—Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π)
php yii pools/cleanup

# –û—á–∏—Å—Ç–∫–∞ —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º –ø–µ—Ä–∏–æ–¥–æ–º (–¥–Ω–∏)
php yii pools/cleanup 60
```

## Cron –∑–∞–¥–∞—á–∏

–ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤ `docker/cron/crontab`:

```cron
# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
*/5 * * * * cd /var/www/html && php yii pools/sync
```

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `pools`
–•—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—É–ª–∞—Ö –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏.

### –¢–∞–±–ª–∏—Ü–∞ `pool_snapshots`
–•—Ä–∞–Ω–∏—Ç —Å–Ω–∏–º–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—É–ª–æ–≤ —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏.

## –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏

- **reserve0/reserve1** - –†–µ–∑–µ—Ä–≤—ã —Ç–æ–∫–µ–Ω–æ–≤ –≤ –ø—É–ª–µ
- **tvl** - Total Value Locked (USD)
- **volume_24h_usd** - –û–±—ä–µ–º —Ç–æ—Ä–≥–æ–≤ –∑–∞ 24 —á–∞—Å–∞
- **apy_1d/7d/30d** - –ì–æ–¥–æ–≤–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –∑–∞ —Ä–∞–∑–Ω—ã–µ –ø–µ—Ä–∏–æ–¥—ã
- **lp_fee/protocol_fee** - –ö–æ–º–∏—Å—Å–∏–∏

## Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã

- **nginx** - Web —Å–µ—Ä–≤–µ—Ä (–ø–æ—Ä—Ç 8080)
- **php** - PHP-FPM –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- **mysql** - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–ø–æ—Ä—Ç 3307, –¥–∞–Ω–Ω—ã–µ –≤ `docker/mysql/data/`)
- **cron** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

### –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–º–æ–≤

- **–ö–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**: `./` ‚Üí `/var/www/html` (–≤—Å–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞)
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: `./docker/mysql/data` ‚Üí `/var/lib/mysql` (–¥–∞–Ω–Ω—ã–µ MySQL –Ω–∞ –¥–∏—Å–∫–µ)
- **Nginx –∫–æ–Ω—Ñ–∏–≥**: `./docker/nginx/default.conf` ‚Üí `/etc/nginx/conf.d/default.conf`
- **Cron –∑–∞–¥–∞—á–∏**: `./docker/cron/crontab` ‚Üí `/etc/cron.d/stonfi-cron`

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
docker-compose down
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
```bash
docker-compose restart
```

### –õ–æ–≥–∏
```bash
# –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker-compose logs -f

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–µ—Ä–≤–∏—Å
docker-compose logs -f php
docker-compose logs -f cron
```

### –û—á–∏—Å—Ç–∫–∞
```bash
# –£–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ volumes
docker-compose down -v
```

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```bash
# Debug –ø–∞–Ω–µ–ª—å
# –£–∂–µ –≤–∫–ª—é—á–µ–Ω–∞ –≤ dev —Ä–µ–∂–∏–º–µ: http://localhost:8080/debug

# Gii (–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–æ–¥–∞)
# –î–æ—Å—Ç—É–ø–µ–Ω –ø–æ: http://localhost:8080/gii
```

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

